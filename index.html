<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, maximum-scale=1" />
<title>–ë–ª—ç–∫–¥–∂–µ–∫ –ø—Ä–æ—Ç–∏–≤ –û–±–µ–∑—å—è–Ω—ã ‚Äî vMobile</title>
<style>
:root{
  /* –¢—ë–º–Ω—ã–π –Ω–µ–æ–Ω */
  --bg:#0b0f12; --bg2:#11171c;
  --felt:#0f2a24; --felt2:#132f28;
  --accent:#00d1b2; --accent2:#8af3e6; --danger:#ff4d6d; --ok:#30e38a; --muted:#9ab0bd;
  --card:#fffdf7; --ink:#0b0f12; --shadow:rgba(0,0,0,.35);
  /* –ê–¥–∞–ø—Ç–∏–≤ –∫–∞—Ä—Ç—ã: —à–∏—Ä–∏–Ω–∞/–≤—ã—Å–æ—Ç–∞ –∏ —Ä–∞–¥–∏—É—Å */
  --card-w: clamp(54px, 16vw, 76px);
  --card-h: calc(var(--card-w) * 1.44);
  --card-r: 10px;
  /* –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ –æ—Ç—Å—Ç—É–ø—ã —Å —É—á—ë—Ç–æ–º safe area */
  --safe-b: env(safe-area-inset-bottom, 0px);
  --safe-t: env(safe-area-inset-top, 0px);
}
*{box-sizing:border-box}
html,body{margin:0;padding:0;background:linear-gradient(180deg,var(--bg2),var(--bg)); color:#e9eef1; font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial}
body{min-height:100svh}

/* –®–∞–ø–∫–∞ */
.header{position:sticky; top:0; z-index:5; display:flex; align-items:center; gap:10px; justify-content:space-between; padding:10px 12px calc(8px + var(--safe-t)); background:linear-gradient(180deg,#0e151aee,#0b1014f5); border-bottom:1px solid #1a2a34; backdrop-filter: blur(8px)}
.h-title{display:flex; align-items:center; gap:8px; font-weight:900}
.h-title .monkey{font-size:1.4rem}
.h-bank{margin-left:auto; background:#0e161a; border:1px solid #1d2a32; padding:6px 10px; border-radius:10px; font-weight:800; color:#b1fff1}

/* –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å —Å—Ç–∞–≤–æ–∫ (—Å–≤–æ—Ä–∞—á–∏–≤–∞–µ–º–∞—è) */
.betbar{position:sticky; top:calc(46px + var(--safe-t)); z-index:4; display:flex; align-items:center; gap:10px; padding:8px 12px; background:#0b1217ef; border-bottom:1px solid #18242b}
.betbar .chips{margin-left:auto; display:flex; gap:8px}
.chip{min-width:42px; height:42px; border-radius:999px; display:grid; place-items:center; background:#121a20; border:1px solid #1f2c35; color:#9ed8cc; font-weight:900}
#bet{width:110px; padding:8px 10px; border-radius:10px; border:1px solid #22323a; background:#0e161a; color:#dce8ee; font-weight:700}
.betbar .toggle-more{margin-left:4px; font-size:.95rem; color:#9ab0bd; background:transparent; border:none}

/* –û—Å–Ω–æ–≤–Ω–∞—è –∑–æ–Ω–∞ —Å—Ç–æ–ª–∞ */
.wrap{display:grid; grid-template-columns:1fr; gap:10px; padding:10px 12px 90px;} /* –Ω–∏–∑ –ø–æ–¥ action-bar */
.table{position:relative; background:
 radial-gradient(60% 80% at 50% 0%, #173b33, #0e2621 60%, #0b1f1b 100%),
 linear-gradient(180deg, var(--felt2), var(--felt));
 border-radius:16px; box-shadow:0 14px 40px #000c, inset 0 0 0 1px #ffffff12; padding:12px; overflow:hidden}
.glow{position:absolute; inset:-10% -10% auto -10%; height:50%; background:radial-gradient(80% 100% at 50% 0%, #00d1b226 0, #ffffff00 60%)}
.name-row{display:flex; align-items:center; gap:8px; font-weight:800}
.avatar{width:34px;height:34px;border-radius:50%; background:#1d3732; display:grid; place-items:center; border:1px solid #2a4e46}
.score{margin-left:auto; font-weight:900; padding:5px 9px; border-radius:9px; background:#0b141680; border:1px solid #1d2a32}
.badge{margin-left:8px; padding:5px 8px; border-radius:999px; background:#0d161a; border:1px solid #1b2b32; font-weight:800; font-size:.85rem; color:#b6c8d3}
.comment{margin:2px 0 8px; font-style:italic; opacity:.95; font-size:.95rem}

.dealer-area,.player-area{display:grid; gap:6px; margin-bottom:6px}
.hands{display:flex; flex-direction:column; gap:8px}
.hand{display:flex; align-items:flex-start; gap:8px; flex-wrap:wrap; min-height:var(--card-h); padding:4px 0}
.hand.is-active{outline:2px dashed #00d1b2aa; outline-offset:6px; border-radius:12px; padding:6px; animation:pulse 1.2s ease-in-out infinite}
@keyframes pulse{50%{outline-color:#8af3e6aa; filter:drop-shadow(0 0 10px #00d1b240)}}

/* –ö–∞—Ä—Ç—ã ‚Äî —Ä–µ–∑–∏–Ω–æ–≤—ã–µ —Ä–∞–∑–º–µ—Ä—ã */
.card{width:var(--card-w); height:var(--card-h); border-radius:var(--card-r); background:var(--card); box-shadow:0 8px 20px var(--shadow), inset 0 0 0 1px #e7e0cf; position:relative; transform:translateY(-14px) scale(.98); opacity:0; animation:deal .42s cubic-bezier(.21,.98,.6,.99) forwards}
@keyframes deal{to{transform:translateY(0) scale(1); opacity:1}}
.card svg{width:100%; height:100%}
.hidden .face{visibility:hidden}
.hidden::after{
  content:"üÇ†"; position:absolute; inset:0; display:grid; place-items:center; font-size:calc(var(--card-w) * .55);
  background:repeating-linear-gradient(45deg, #1b255a 0 10px, #121a49 10px 20px);
  color:#e5ecff; border-radius:var(--card-r); box-shadow: inset 0 0 0 1px #2d3c90;
}

/* –ù–∏–∂–Ω—è—è —ç–∫—à–Ω‚Äë–ø–∞–Ω–µ–ª—å (—Ñ–∏–∫—Å) */
.action-bar{
  position:fixed; left:0; right:0; bottom:0; z-index:6; padding:10px 10px calc(10px + var(--safe-b));
  background:#0b1217ee; backdrop-filter:blur(8px); border-top:1px solid #1a2a34;
}
.action-grid{
  display:grid; grid-template-columns:repeat(3, minmax(0,1fr)); gap:8px;
}
.btn{appearance:none; border:none; background:linear-gradient(180deg,#0e2622,#0b1f1c); color:#bffcf2; border:1px solid #13443b; font-weight:900; letter-spacing:.2px; padding:12px 10px; border-radius:12px; box-shadow:0 6px 16px #00d1b220, inset 0 0 24px #00d1b210; transform:translateY(0); transition:transform .06s ease}
.btn:active{transform:translateY(2px)}
.secondary{background:linear-gradient(180deg,#2b2331,#1e1923); border-color:#3b2b46; color:#e9d2ff}
.ghost{background:linear-gradient(180deg,#1b2126,#151a1f); border-color:#28313a; color:#d7e2ea}
.success{background:linear-gradient(180deg,#11311f,#0e291a); border-color:#235a43; color:#c6ffe6}
.danger{background:linear-gradient(180deg,#2a1219,#1f0f14); border-color:#5a1e2f; color:#ffd7de}
button[disabled]{opacity:.5}

/* –ê–∫–∫–æ—Ä–¥–µ–æ–Ω—ã */
.accord{background:#0c1418; border:1px solid #19262c; border-radius:12px; overflow:hidden}
.accord summary{list-style:none; padding:10px 12px; cursor:pointer; font-weight:800; display:flex; align-items:center; justify-content:space-between}
.accord summary::-webkit-details-marker{display:none}
.accord .body{padding:10px 12px; border-top:1px solid #1a2a34}
.stats{display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:6px}
.stat{background:#0f1a20; border:1px solid #1a2a34; padding:8px 10px; border-radius:10px; text-align:center; font-weight:800}
.log{max-height:40vh; overflow:auto; font-size:.92rem}

/* –ë–∞–Ω–Ω–µ—Ä */
.banner{position:fixed; left:50%; transform:translate(-50%,-120%); top:8px; background:#0b1217ee; border:1px solid #20313a; padding:10px 14px; border-radius:10px; font-weight:800; color:#affff3; opacity:0; pointer-events:none; box-shadow:0 18px 50px #000a; z-index:7}
.banner.show{animation:drop .9s ease forwards}
@keyframes drop{0%{transform:translate(-50%,-120%); opacity:0} 40%{transform:translate(-50%,10%); opacity:1} 100%{transform:translate(-50%,-20%); opacity:1}}

/* –õ—ç–π–∞—É—Ç –Ω–∞ –ø–ª–∞–Ω—à–µ—Ç–µ/–¥–µ—Å–∫—Ç–æ–ø–µ */
@media (min-width:880px){
  .wrap{grid-template-columns:1fr 320px; padding-bottom:100px}
  .action-grid{grid-template-columns:repeat(6,1fr)}
}

/* –£–ª—å—Ç—Ä–∞‚Äë–∫–æ–º–ø–∞–∫—Ç –ø—Ä–∏ –º–∞–ª–µ–Ω—å–∫–æ–π –≤—ã—Å–æ—Ç–µ (–≤ –ª–∞–Ω–¥—à–∞—Ñ—Ç–µ) */
@media (max-height:700px){
  :root{ --card-w: clamp(48px, 12.5vw, 68px); }
  .wrap{padding-bottom:86px}
}
</style>
</head>
<body>
<div class="header">
  <div class="h-title"><span class="monkey">üêí</span> –ë–ª—ç–∫–¥–∂–µ–∫ –ø—Ä–æ—Ç–∏–≤ –û–±–µ–∑—å—è–Ω—ã ‚Äî vMobile</div>
  <div class="h-bank">–ë–∞–Ω–∞–Ω—ã: <span id="bank">500</span> üçå</div>
</div>

<div class="betbar">
  <strong>–°—Ç–∞–≤–∫–∞ (üçå):</strong>
  <input id="bet" type="number" min="1" step="1" value="25" />
  <div class="chips">
    <button class="chip" data-chip="10">+10</button>
    <button class="chip" data-chip="25">+25</button>
    <button class="chip" data-chip="50">+50</button>
    <button class="chip" data-chip="-10">-10</button>
    <button class="chip" data-chip="max">MAX</button>
  </div>
  <button class="toggle-more" id="togglePanels">–ü–∞–Ω–µ–ª–∏ ‚åÑ</button>
</div>

<div class="wrap">
  <div class="table" id="table">
    <div class="glow"></div>
    <div id="banner" class="banner">üîÅ –ü–µ—Ä–µ—Ç–∞—Å–æ–≤–∫–∞‚Ä¶ –û–±–µ–∑—å—è–Ω–∞ —à–µ–ø—á–µ—Ç –∫–∞—Ä—Ç–∞–º</div>

    <div class="dealer-area">
      <div class="name-row">
        <div class="avatar"><span>üêí</span></div>
        <div><strong>–î–∏–ª–µ—Ä: –û–±–µ–∑—å—è–Ω–∞</strong></div>
        <span class="badge" id="shoeInfo">–¢—É—Ñ–ª—è: 6 –∫–æ–ª–æ–¥ ‚Ä¢ 0% –∏–∑—Ä–∞—Å—Ö–æ–¥–æ–≤–∞–Ω–æ</span>
        <div class="score" id="dealerScore">‚Äî</div>
      </div>
      <div class="hand" id="dealerHand"></div>
      <div class="comment" id="dealerComment">¬´–°—Ç–∞–≤–∫–∏ –ø–æ–≤—ã—à–µ ‚Äî –±–∞–Ω–∞–Ω—ã –ø–æ–≤–∫—É—Å–Ω–µ–µ‚Ä¶¬ª</div>
    </div>

    <div class="player-area">
      <div class="name-row">
        <div class="avatar"><span>üßë</span></div>
        <div><strong>–ò–≥—Ä–æ–∫</strong></div>
        <span class="badge">–ü—Ä–∞–≤–∏–ª–æ –¥–∏–ª–µ—Ä–∞: <b id="ruleText">S17</b></span>
        <div class="score" id="playerScore">‚Äî</div>
      </div>
      <div class="hands" id="handsContainer">
        <div class="hand is-active" id="playerHand0"></div>
      </div>
      <div class="comment" id="playerComment">–ü–æ—Å—Ç–∞–≤—å –∏ –∂–º–∏ ¬´–†–∞–∑–¥–∞—Ç—å¬ª.</div>
    </div>
  </div>

  <!-- –ê–∫–∫–æ—Ä–¥–µ–æ–Ω—ã (–º–æ–±–∞–π–ª ‚Äî —Å–≤—ë—Ä–Ω—É—Ç—ã) -->
  <details class="accord" id="statsAcc">
    <summary>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ <span id="statsHint" style="opacity:.7;font-weight:600"></span></summary>
    <div class="body">
      <div class="stats">
        <div class="stat">–†–∞—É–Ω–¥–æ–≤: <span id="stRounds">0</span></div>
        <div class="stat">–ü–æ–±–µ–¥: <span id="stWins">0</span></div>
        <div class="stat">–ü—É—à–µ–π: <span id="stPush">0</span></div>
        <div class="stat">–ë–ª—ç–∫–¥–∂–µ–∫–æ–≤: <span id="stBJ">0</span></div>
        <div class="stat">–ü—Ä–æ—Ñ–∏—Ç (üçå): <span id="stProfit">0</span></div>
        <div class="stat">–ú–∞–∫—Å —Å–µ—Ä–∏—è: <span id="stStreak">0</span></div>
      </div>
    </div>
  </details>

  <details class="accord" id="logAcc">
    <summary>üìù –ò—Å—Ç–æ—Ä–∏—è</summary>
    <div class="body">
      <div id="log" class="log"></div>
    </div>
  </details>
</div>

<!-- –ù–∏–∂–Ω—è—è —Ñ–∏–∫—Å‚Äë–ø–∞–Ω–µ–ª—å –¥–µ–π—Å—Ç–≤–∏–π -->
<div class="action-bar">
  <div class="action-grid">
    <button id="dealBtn" class="btn">–†–∞–∑–¥–∞—Ç—å</button>
    <button id="hitBtn" class="btn secondary" disabled>–ï—â—ë</button>
    <button id="standBtn" class="btn ghost" disabled>–•–≤–∞—Ç–∏—Ç</button>
    <button id="doubleBtn" class="btn" disabled>–î–∞–±–ª</button>
    <button id="splitBtn" class="btn" disabled>–°–ø–ª–∏—Ç</button>
    <button id="surrenderBtn" class="btn danger" disabled>–°–¥–∞—á–∞</button>
  </div>
  <div class="action-grid" style="margin-top:8px">
    <button id="insuranceBtn" class="btn success" disabled>–°—Ç—Ä–∞—Ö–æ–≤–∫–∞</button>
    <!-- –ø—É—Å—Ç—ã–µ —è—á–µ–π–∫–∏ –¥–ª—è –∞–∫–∫—É—Ä–∞—Ç–Ω–æ–π —Å–µ—Ç–∫–∏ -->
    <span></span><span></span><span></span><span></span><span></span>
  </div>
</div>

<script>
(() => {
  const $ = s => document.querySelector(s);
  const $$ = s => Array.from(document.querySelectorAll(s));
  const banner = $('#banner'), logEl = $('#log');

  // --- Compact hints
  const statsHint = $('#statsHint');
  function setStatsHint(){ statsHint.textContent = window.innerWidth < 880 ? '‚Ä¢ –Ω–∞–∂–º–∏, —á—Ç–æ–±—ã —Ä–∞—Å–∫—Ä—ã—Ç—å' : ''; }
  setStatsHint(); addEventListener('resize', setStatsHint);

  // --- Panels toggle (—Å–∫—Ä—ã—Ç—å/–ø–æ–∫–∞–∑–∞—Ç—å –∞–∫–∫–æ—Ä–¥–µ–æ–Ω—ã –±—ã—Å—Ç—Ä–æ)
  $('#togglePanels').addEventListener('click', ()=>{
    $('#statsAcc').open = !$('#statsAcc').open;
    $('#logAcc').open = !$('#logAcc').open;
  });

  // --- Options
  let OPT = { decks:6, penetration:75, S17:true, minBet:5, maxBet:500 };

  // --- Elements
  const dealerHandEl = $('#dealerHand'), dealerScoreEl = $('#dealerScore'), dealerCommentEl = $('#dealerComment');
  const handsContainer = $('#handsContainer'), playerScoreEl = $('#playerScore'), playerCommentEl = $('#playerComment');
  const bankEl = $('#bank'), shoeInfoEl = $('#shoeInfo'), ruleText = $('#ruleText');
  const betInput = $('#bet');
  const dealBtn = $('#dealBtn'), hitBtn = $('#hitBtn'), standBtn = $('#standBtn'), doubleBtn = $('#doubleBtn'), splitBtn = $('#splitBtn'), surrenderBtn = $('#surrenderBtn'), insuranceBtn = $('#insuranceBtn');
  const stRounds = $('#stRounds'), stWins=$('#stWins'), stPush=$('#stPush'), stBJ=$('#stBJ'), stProfit=$('#stProfit'), stStreak=$('#stStreak');

  // --- –†–µ–ø–ª–∏–∫–∏ (–¥–æ–±–∞–≤–ª–µ–Ω—ã —è–∑–≤–∏—Ç–µ–ª—å–Ω—ã–µ)
  const lines = {
    start: [
      "¬´–°—Ç–∞–≤–∫–∏ –ø–æ–≤—ã—à–µ ‚Äî –±–∞–Ω–∞–Ω—ã –ø–æ–≤–∫—É—Å–Ω–µ–µ‚Ä¶¬ª","¬´–Ø –Ω–µ –∂—É–ª—å–Ω–∏—á–∞—é. –ü—Ä–æ—Å—Ç–æ –∫–∞—Ä—Ç—ã –º–µ–Ω—è –æ–±–æ–∂–∞—é—Ç.¬ª","¬´–ü–∞—Ö–Ω–µ—Ç –ø–æ–±–µ–¥–æ–π. –ò–ª–∏ —ç—Ç–æ –º–æ–∏ –±–∞–Ω–∞–Ω—ã?¬ª",
      "¬´–ö—Ç–æ-—Ç–æ –ø—Ä–∏—à—ë–ª –ø–æ—Ç–µ—Ä—è—Ç—å –≤–∏—Ç–∞–º–∏–Ω B(–∞–Ω–∞–Ω—ã)?¬ª","¬´–î–∂—É–Ω–≥–ª–∏ —à–µ–ø—á—É—Ç: —Ç—è–Ω–∏. –ú–Ω–µ —Ç–∞–∫ –≤—ã–≥–æ–¥–Ω–æ.¬ª","¬´–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –¥–∏–ª–µ—Ä. –õ—é–±–∏—Ç–µ–ª—å —á—É–∂–∏—Ö –±–∞–Ω–∞–Ω–æ–≤.¬ª",
      "¬´–ù–µ –ø–µ—Ä–µ–∂–∏–≤–∞–π, –ò–≥—Ä–æ–∫. –Ø –Ω–µ–∂–Ω–æ –∑–∞–±–µ—Ä—É –Ω–µ–º–Ω–æ–≥–æ –±–∞–Ω–∞–Ω–æ–≤.¬ª","¬´–ü—Ä–∞–≤–∏–ª–∞ –ø—Ä–æ—Å—Ç—ã: —Ç—ã —Å—Ç–∞–≤–∏—à—å ‚Äî —è —É–ª—ã–±–∞—é—Å—å.¬ª"
    ],
    playerBlackjack: [
      "¬´–ë–ª—ç–∫–¥–∂–µ–∫? –õ–∞–¥–Ω–æ‚Ä¶ —É–≤–∞–∂–µ–Ω–∏–µ. –ù–æ –Ω–µ –ø—Ä–∏–≤—ã–∫–∞–π.¬ª","¬´–ö–∞—Ä—Ç—ã —Ç–µ–±—è –ª—é–±—è—Ç. –Ø ‚Äî –Ω–µ –æ—á–µ–Ω—å.¬ª",
      "¬´–ö—Ä–∞—Å–∏–≤–æ. –í —Å–ª–µ–¥—É—é—â–∏–π —Ä–∞–∑ ‚Äî –Ω–µ –æ—Ç–≤–ª–µ–∫—É—Å—å.¬ª","¬´–°–ª—É—á–∞–π–Ω–æ—Å—Ç—å —É—Ä–æ–≤–Ω—è –æ–±–µ–∑—å—è–Ω—å–µ–π —ç–≤–æ–ª—é—Ü–∏–∏.¬ª"
    ],
    dealerWin: [
      "¬´–û–±–µ–∑—å—è–Ω–∞ –≤–∞—Å –≤—ã–∏–≥—Ä–∞–ª–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞. –í—ã –ø–æ—Ç–µ—Ä—è–ª–∏ –±–∞–Ω–∞–Ω—ã.¬ª","¬´–ë–∞–Ω–∞–Ω—ã ‚Äî —Å—é–¥–∞. –≠–º–æ—Ü–∏–∏ ‚Äî —Å–µ–±–µ.¬ª",
      "¬´–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–∞—Ö–Ω–µ—Ç –ø–æ–±–µ–¥–æ–π‚Ä¶ –º–æ–µ–π.¬ª","¬´–Ø –±—ã —Å–æ—á—É–≤—Å—Ç–≤–æ–≤–∞–ª–∞, –Ω–æ –∑–∞–Ω—è—Ç(–∞) –±—É—Ö–≥–∞–ª—Ç–µ—Ä–∏–µ–π –±–∞–Ω–∞–Ω–æ–≤.¬ª"
    ],
    playerWin: [
      "¬´–•–º. –í–ø–µ—á–∞—Ç–ª—è–µ—Ç. –í—Ä–µ–º–µ–Ω–Ω–æ.¬ª","¬´–ó–∞–ø–∏—à–∏ –≤ –¥–Ω–µ–≤–Ω–∏–∫: –æ–±–µ–∑—å—è–Ω–∞ –æ—Ç–≤–ª–µ–∫–ª–∞—Å—å.¬ª",
      "¬´–û–∫–µ–π, –∑–∞–±–µ—Ä–∏. –ù–æ –¥–∂—É–Ω–≥–ª–∏ –ø–æ–º–Ω—è—Ç.¬ª","¬´–°–ª—É—á–∞–π–Ω–æ—Å—Ç–∏ ‚Äî —Ç–æ–∂–µ —á–∞—Å—Ç—å –ø—Ä–∏—Ä–æ–¥—ã.¬ª"
    ],
    push: ["¬´–ü—É—à. –°–∫—É—á–Ω–æ. –ù–æ –∂–∏–≤–∏ –ø–æ–∫–∞.¬ª","¬´–ù–∏—á—å—è ‚Äî —ç—Ç–æ –∫–æ–≥–¥–∞ –æ–±–∞ –Ω–µ—Å—á–∞—Å—Ç–Ω—ã.¬ª","¬´–ü–æ–∫–∞ –±–µ–∑ –±–∞–Ω–∞–Ω–æ–≤. –†–∞–∑–æ—á–∞—Ä–æ–≤–∞–ª–∞.¬ª"],
    hit: ["¬´–ï—â—ë? –õ—é–±–ª—é –∑—Ä–µ–ª–∏—â–∞.¬ª","¬´–¢—è–Ω–∏-—Ç—è–Ω–∏‚Ä¶ –º–æ–∂–µ—Ç –∏ –ø–æ–≤–µ–∑—ë—Ç. –ú–Ω–µ.¬ª","¬´–î–∞–≤–∞–π, –≥–µ—Ä–æ–π. –ö–∞—Ä—Ç–∞ –Ω–µ –∫—É—Å–∞–µ—Ç—Å—è. –Ø ‚Äî –¥–∞.¬ª"],
    stand: ["¬´–°—Ç–æ–∏—à—å? –û—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç—å ‚Äî –ø—É—Ç—å –∫‚Ä¶ —Å–∫—É–∫–µ.¬ª","¬´–•–æ—Ä–æ—à–æ. –ü–æ–π–¥—É –≤–æ—Ä–æ–≤–∞—Ç—å —Ç–≤–æ–∏ —à–∞–Ω—Å—ã.¬ª"],
    double: ["¬´–î–∞–±–ª! –û–±–æ–∂–∞—é —É–¥–≤–∞–∏–≤–∞—Ç—å‚Ä¶ —á—É–∂–∏–µ —Å–ª—ë–∑—ã.¬ª","¬´–°–º–µ–ª–æ. –ò–ª–∏ –±–∞–Ω–∞–Ω–æ–≤–æ‚Äë–±–µ–∑—Ä–∞—Å—Å—É–¥–Ω–æ.¬ª"],
    split: ["¬´–°–ø–ª–∏—Ç? –†–∞–∑–º–Ω–æ–∂–∏–ª –ø—Ä–æ–±–ª–µ–º—ã ‚Äî —É–≤–∞–∂–∞—é –∫—Ä–µ–∞—Ç–∏–≤.¬ª","¬´–î–≤–∞ —à–∞–Ω—Å–∞? –î–≤–∞ –ø—Ä–æ–º–∞—Ö–∞?¬ª"],
    bust: ["¬´–ü–µ—Ä–µ–±–æ—Ä. –ë–∞–Ω–∞–Ω—ã –≤ —É—Ç–∏–ª—å.¬ª","¬´21 ‚Äî –º–µ—á—Ç–∞. –£ —Ç–µ–±—è ‚Äî 22. –¢–æ–∂–µ —á–∏—Å–ª–æ.¬ª","¬´–ù–∞–∑–æ–≤—ë–º —ç—Ç–æ —Ç–≤–æ—Ä—á–µ—Å–∫–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π.¬ª"],
    insure: ["¬´–°—Ç—Ä–∞—Ö–æ–≤–∫–∞? –í–∫—É—Å–Ω–æ –ø–∞—Ö–Ω–µ—Ç –æ—Ç—á–∞—è–Ω–∏–µ–º.¬ª","¬´–ü–æ–ª–±–∞–Ω–∞–Ω–∞ –Ω–∞ —Å—Ç—Ä–∞—Ö ‚Äî –∏–º–±–∏—Ä–Ω—ã–π –ø—Ä–∏–≤–∫—É—Å –ø–æ—Ä–∞–∂–µ–Ω–∏—è.¬ª"],
    surrender: ["¬´–°–¥–∞—á–∞ –ø—Ä–∏–Ω—è—Ç–∞. –°–º–µ–ª–æ—Å—Ç—å ‚Äî –∑–Ω–∞—Ç—å, –∫–æ–≥–¥–∞ –±–µ–∂–∞—Ç—å.¬ª","¬´–ü–æ–ª–±–∞–Ω–∞–Ω–∞ –Ω–∞–∑–∞–¥. –ö–æ–º–∏—Å—Å–∏—è ‚Äî –Ω–æ–ª—å.¬ª"]
  };

  // --- Shoe / state
  const ranks=["A","2","3","4","5","6","7","8","9","10","J","Q","K"];
  const suits=[{s:"‚ô†",c:"#121620"},{s:"‚ô•",c:"#c62828"},{s:"‚ô¶",c:"#c62828"},{s:"‚ô£",c:"#121620"}];
  let shoe=[], cutPoint=0, used=0;
  let bank=500, inRound=false, insuranceOffered=false, insuranceTaken=0;
  let dealer={hand:[], hideHole:true};
  let playerHands=[]; // {cards:[], bet, done, doubled, isBust, isBJ}
  let surrenderedHands=new Set();
  let activeHandIndex=0; const MAX_HANDS=4;
  // stats
  let rounds=0, wins=0, pushes=0, bjs=0, profit=0, streak=0, maxStreak=0;

  function buildShoe(decks=6){ const arr=[]; for(let d=0; d<decks; d++) for(const r of ranks) for(const su of suits) arr.push({rank:r,suit:su.s,color:su.c}); shuffle(arr); used=0; cutPoint=Math.floor(arr.length*(OPT.penetration/100)); return arr; }
  function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]];} return a; }
  function drawOne(){ if(used>=cutPoint) reshuffle(); used++; updateShoeInfo(); return shoe.pop(); }
  function reshuffle(){ toast('üîÅ –ü–µ—Ä–µ—Ç–∞—Å–æ–≤–∫–∞‚Ä¶ –û–±–µ–∑—å—è–Ω–∞ —à–µ–ø—á–µ—Ç –∫–∞—Ä—Ç–∞–º'); shoe=buildShoe(OPT.decks); }
  function updateShoeInfo(){ const total=OPT.decks*52; const pct=Math.min(100, Math.floor(used/total*100)); shoeInfoEl.textContent=`–¢—É—Ñ–ª—è: ${OPT.decks} –∫–æ–ª–æ–¥ ‚Ä¢ ${pct}% –∏–∑—Ä–∞—Å—Ö–æ–¥–æ–≤–∞–Ω–æ`; }

  // --- Cards (SVG)
  function cardSVG(rank, suit, color="#111"){
    const top=rank+" "+suit, bot=suit+" "+rank;
    return `<svg viewBox="0 0 72 104" class="face" aria-label="${rank}${suit}">
      <defs><filter id="sd"><feDropShadow dx="0" dy="1" stdDeviation="1" flood-opacity=".25"/></filter></defs>
      <rect x="1.5" y="1.5" width="69" height="101" rx="9" fill="#fffdf7" stroke="#e7e0cf"/>
      <text x="6" y="14" font-family="ui-sans" font-weight="900" font-size="12" fill="${color}">${top}</text>
      <g transform="rotate(180,36,52)"><text x="6" y="14" font-family="ui-sans" font-weight="900" font-size="12" fill="${color}">${bot}</text></g>
      <g filter="url(#sd)">${pips(rank,suit,color)}</g></svg>`;
  }
  function pips(rank,suit,color){
    const cx=36, cy=52;
    if(rank==="A") return `<text x="${cx}" y="${cy+10}" text-anchor="middle" font-size="52" font-weight="900" fill="${color}">${suit}</text>`;
    if(/^[2-9]|10$/.test(rank)){
      const n=(rank==="10")?10:parseInt(rank,10);
      const coords=[[36,32],[36,72],[20,42],[52,42],[20,62],[52,62],[20,32],[52,32],[20,72],[52,72]];
      return coords.slice(0,n).map(([x,y])=>`<text x="${x}" y="${y}" text-anchor="middle" font-size="18" font-weight="800" fill="${color}">${suit}</text>`).join("");
    }
    return `<text x="${cx}" y="${cy+10}" text-anchor="middle" font-size="46" font-weight="800" fill="${color}">${suit}</text>`;
  }
  function createCardEl(card, hidden=false, delayIdx=0){
    const el=document.createElement('div');
    el.className='card'+(hidden?' hidden':'');
    el.style.animationDelay=(0.08*delayIdx)+'s';
    el.innerHTML = card ? cardSVG(card.rank, card.suit, card.color) : '';
    return el;
  }

  // --- Values
  function handValue(cards){ let t=0,a=0; for(const c of cards){ if(c.rank==="A"){t+=11;a++;} else if(["K","Q","J"].includes(c.rank)){t+=10;} else t+=(c.rank==="10"?10:parseInt(c.rank,10)); } while(t>21&&a>0){t-=10;a--;} return t; }
  const isBJ = (cards)=> cards.length===2 && handValue(cards)===21;
  const isPair = (cards)=> cards.length===2 && rankVal(cards[0])===rankVal(cards[1]);
  function rankVal(c){ if(c.rank==="A")return 11; if(["K","Q","J","10"].includes(c.rank))return 10; return parseInt(c.rank,10) }
  function isSoft(cards){ let t=0,a=0; for(const c of cards){ if(c.rank==="A"){t+=11;a++;} else if(["K","Q","J"].includes(c.rank)){t+=10;} else t+=(c.rank==="10"?10:parseInt(c.rank,10)); } while(t>21&&a>0){t-=10;a--;} return a>0; }

  // --- UI helpers
  function getActiveEl(){ return $('#playerHand'+activeHandIndex); }
  function setActiveHand(idx){ $$('.hand').forEach(h=>h.classList.remove('is-active')); activeHandIndex=idx; $('#playerHand'+idx).classList.add('is-active'); refreshScores(); setActionsForActive(); }
  function setComment(el,t){ el.textContent=t; }
  function updateBank(){ bankEl.textContent=bank; }
  function clamp(v,min,max){ return Math.max(min, Math.min(max, v)); }
  function rnd(a){ return a[Math.floor(Math.random()*a.length)]; }
  function toast(txt){ banner.textContent=txt; banner.classList.add('show'); setTimeout(()=>banner.classList.remove('show'),1400); }
  function log(msg){ const row=document.createElement('div'); row.textContent=msg; logEl.prepend(row); }

  // --- Round flow
  function resetTableUI(){
    dealerHandEl.innerHTML=''; dealerScoreEl.textContent='‚Äî';
    handsContainer.innerHTML=''; const h=document.createElement('div'); h.id='playerHand0'; h.className='hand is-active'; handsContainer.appendChild(h);
    playerScoreEl.textContent='‚Äî';
    surrenderedHands.clear(); insuranceTaken=0; insuranceOffered=false;
    setComment(dealerCommentEl, rnd(lines.start)); setComment(playerCommentEl, '–ü–æ—Å—Ç–∞–≤—å –∏ –∂–º–∏ ¬´–†–∞–∑–¥–∞—Ç—å¬ª.');
  }
  function refreshScores(){
    const dVal = dealer.hideHole ? handValue(dealer.hand.slice(1)) : handValue(dealer.hand);
    dealerScoreEl.textContent = dealer.hideHole ? `? + ${handValue([dealer.hand[1]])}` : dVal;
    const active = playerHands[activeHandIndex] || playerHands[0];
    playerScoreEl.textContent = handValue(active.cards);
  }
  function setActionsForActive(){
    const h = playerHands[activeHandIndex];
    const initial = h.cards.length===2;
    hitBtn.disabled=false; standBtn.disabled=false;
    doubleBtn.disabled = !initial || bank < h.bet;
    splitBtn.disabled  = !(initial && isPair(h.cards) && playerHands.length<MAX_HANDS && bank >= h.bet);
    surrenderBtn.disabled = !initial;
    const dealerUpAce = dealer.hand[1]?.rank==='A' && dealer.hideHole;
    insuranceBtn.disabled = !(initial && dealerUpAce && !insuranceOffered && bank >= Math.floor(h.bet/2));
  }

  function startRound(){
    let b=parseInt(betInput.value||25,10);
    b = clamp(b, OPT.minBet, Math.min(OPT.maxBet, bank)); betInput.value=b;
    if(b>bank) return alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–∞–Ω–∞–Ω–æ–≤.');
    if(b<OPT.minBet) return alert(`–ú–∏–Ω —Å—Ç–∞–≤–∫–∞ ${OPT.minBet}üçå`);
    inRound=true; surrenderedHands.clear(); insuranceTaken=0; insuranceOffered=false;
    bank -= b; updateBank();

    dealer={hand:[], hideHole:true};
    playerHands=[{cards:[], bet:b, done:false, doubled:false, isBust:false, isBJ:false}];
    activeHandIndex=0;

    resetTableUI();

    const ph=getActiveEl();
    const p1=drawOne(); playerHands[0].cards.push(p1); ph.appendChild(createCardEl(p1,false,0));
    const d1=drawOne(); dealer.hand.push(d1); dealerHandEl.appendChild(createCardEl(d1,true,1));
    const p2=drawOne(); playerHands[0].cards.push(p2); ph.appendChild(createCardEl(p2,false,2));
    const d2=drawOne(); dealer.hand.push(d2); dealerHandEl.appendChild(createCardEl(d2,false,3));

    refreshScores();
    maybeOfferInsurance();

    if(isBJ(playerHands[0].cards)){
      playerHands[0].isBJ=true; finishPlayerPhase(true); setComment(dealerCommentEl, rnd(lines.playerBlackjack)); return;
    }
    dealBtn.disabled=true; setActionsForActive();
    setComment(playerCommentEl,'–•–æ–¥ –ò–≥—Ä–æ–∫–∞: –ï—â—ë / –•–≤–∞—Ç–∏—Ç / –î–∞–±–ª / –°–ø–ª–∏—Ç / –°–¥–∞—á–∞.');
  }

  function maybeOfferInsurance(){
    const up=dealer.hand[1]; if(up && up.rank==='A'){ insuranceOffered=true; insuranceBtn.disabled=false; setComment(dealerCommentEl,'¬´–¢—É–∑ –Ω–∞–≤–µ—Ä—Ö—É‚Ä¶ –±–µ—Ä—ë—à—å —Å—Ç—Ä–∞—Ö–æ–≤–∫—É?¬ª'); }
  }
  function takeInsurance(){
    const h=playerHands[activeHandIndex]; const cost=Math.floor(h.bet/2);
    if(bank < cost) return alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–∞–Ω–∞–Ω–æ–≤ –¥–ª—è —Å—Ç—Ä–∞—Ö–æ–≤–∫–∏.');
    bank -= cost; updateBank(); insuranceTaken=cost; insuranceBtn.disabled=true; setComment(dealerCommentEl, rnd(lines.insure));
  }

  function hit(){
    const h=playerHands[activeHandIndex]; const el=getActiveEl();
    const c=drawOne(); h.cards.push(c); el.appendChild(createCardEl(c,false,h.cards.length+1));
    setComment(dealerCommentEl, rnd(lines.hit)); refreshScores();
    doubleBtn.disabled=true; splitBtn.disabled=true; surrenderBtn.disabled=true; insuranceBtn.disabled=true;
    if(handValue(h.cards)>21){ h.isBust=true; setComment(dealerCommentEl, rnd(lines.bust)); nextHandOrDealer(); }
  }
  function stand(){ setComment(dealerCommentEl, rnd(lines.stand)); nextHandOrDealer(); }
  function doDouble(){
    const h=playerHands[activeHandIndex];
    if(h.cards.length!==2 || bank < h.bet) return;
    bank -= h.bet; h.bet*=2; h.doubled=true; updateBank();
    setComment(dealerCommentEl, rnd(lines.double)); hit(); if(!h.isBust) nextHandOrDealer();
  }
  function doSplit(){
    const base=playerHands[activeHandIndex];
    if(!(base.cards.length===2 && isPair(base.cards))) return;
    if(playerHands.length>=MAX_HANDS) return alert('–ú–∞–∫—Å–∏–º—É–º 4 —Ä—É–∫–∏.');
    if(bank < base.bet) return alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–∞–Ω–∞–Ω–æ–≤ –Ω–∞ —Å–ø–ª–∏—Ç.');
    bank -= base.bet; updateBank(); setComment(dealerCommentEl, rnd(lines.split));

    const c1=base.cards[0], c2=base.cards[1];
    base.cards=[c1];
    const newHand={cards:[c2], bet:base.bet, done:false, doubled:false, isBust:false, isBJ:false};
    playerHands.splice(activeHandIndex+1,0,newHand);

    handsContainer.innerHTML='';
    playerHands.forEach((h, idx)=>{ const d=document.createElement('div'); d.id='playerHand'+idx; d.className='hand'+(idx===activeHandIndex?' is-active':''); d.appendChild(createCardEl(h.cards[0],false,0)); handsContainer.appendChild(d); });

    const add=(h, idx)=>{ const card=drawOne(); h.cards.push(card); $('#playerHand'+idx).appendChild(createCardEl(card,false,1)); };
    add(base, activeHandIndex); add(newHand, activeHandIndex+1);

    if(c1.rank==="A" && c2.rank==="A"){ nextHandOrDealer(true); } else { refreshScores(); setActionsForActive(); }
  }
  function surrender(){
    const h=playerHands[activeHandIndex]; if(h.cards.length!==2) return;
    surrenderedHands.add(activeHandIndex); h.done=true; setComment(dealerCommentEl, rnd(lines.surrender));
    const refund=Math.floor(h.bet/2); bank += refund; updateBank(); log(`–°–¥–∞—á–∞ —Ä—É–∫–∏ #${activeHandIndex+1}: +${refund}üçå`); nextHandOrDealer();
  }

  function nextHandOrDealer(forceFinish=false){
    playerHands[activeHandIndex].done=true;
    const nextIdx = playerHands.findIndex((h, idx)=> idx>activeHandIndex && !h.done);
    if(nextIdx!==-1 && !forceFinish){ setActiveHand(nextIdx); return; }
    finishPlayerPhase(false);
  }
  function finishPlayerPhase(){ hitBtn.disabled=standBtn.disabled=doubleBtn.disabled=splitBtn.disabled=surrenderBtn.disabled=insuranceBtn.disabled=true; dealerPlay(); }

  function dealerPlay(){
    dealer.hideHole=false; if(dealerHandEl.firstElementChild) dealerHandEl.firstElementChild.classList.remove('hidden'); refreshScores();
    const anyActive = playerHands.some((h,idx)=> !h.isBust && !surrenderedHands.has(idx)); if(!anyActive){ return resolveRound(); }
    const step=()=>{ let v=handValue(dealer.hand); const soft=isSoft(dealer.hand);
      const mustHit = v<17 || (!OPT.S17 && v===17 && soft);
      if(mustHit){ const c=drawOne(); dealer.hand.push(c); dealerHandEl.appendChild(createCardEl(c,false,dealer.hand.length+1)); refreshScores(); setTimeout(step, 520); }
      else resolveRound();
    };
    setTimeout(step, 520);
  }

  function resolveRound(){
    dealBtn.disabled=false;
    const dealerTotal=handValue(dealer.hand); const dealerBJ=isBJ(dealer.hand);
    if(insuranceTaken){ if(dealerBJ){ bank += insuranceTaken*3; log(`–°—Ç—Ä–∞—Ö–æ–≤–∫–∞ –≤—ã–ø–ª–∞—Ç–∏–ª–∞ ${insuranceTaken*2}üçå`);} else { log(`–°—Ç—Ä–∞—Ö–æ–≤–∫–∞ –ø—Ä–æ–∏–≥—Ä–∞–ª–∞ ${insuranceTaken}üçå`);} insuranceTaken=0; updateBank(); }

    let roundProfit=0; let allDealer=true, allPush=true, anyBJ=false, anyPlayerWin=false;
    playerHands.forEach((h, idx)=>{
      if(surrenderedHands.has(idx)){ allDealer=false; allPush=false; return; }
      const total=handValue(h.cards); let delta=0, outcome='';
      if(h.isBJ && !dealerBJ){ delta=Math.floor(h.bet*2.5); outcome='playerBJ'; anyBJ=true; anyPlayerWin=true; allDealer=false; allPush=false; bjs++; }
      else if(h.isBust){ outcome='dealer'; }
      else if(dealerTotal>21){ delta=h.bet*2; outcome='player'; anyPlayerWin=true; allDealer=false; allPush=false; }
      else if(dealerBJ && !h.isBJ){ outcome='dealer'; }
      else if(total>dealerTotal){ delta=h.bet*2; outcome='player'; anyPlayerWin=true; allDealer=false; allPush=false; }
      else if(total<dealerTotal){ outcome='dealer'; }
      else { delta=h.bet; outcome='push'; allDealer=false; pushes++; }
      roundProfit += (delta - h.bet);
      const tag = outcome==='player' || outcome==='playerBJ' ? '‚úÖ' : (outcome==='push' ? '‚è∏Ô∏è' : '‚ùå');
      log(`${tag} –†—É–∫–∞ #${idx+1}: ${format(h.cards)} vs ${dealerTotal} ‚Äî ${desc(outcome)} | Œî ${delta - h.bet}üçå`);
    });

    profit += roundProfit; rounds++; if(anyPlayerWin){ wins++; streak++; maxStreak=Math.max(maxStreak,streak);} else if(allPush){/*noop*/} else { streak=0; }
    stRounds.textContent=rounds; stWins.textContent=wins; stPush.textContent=pushes; stBJ.textContent=bjs; stProfit.textContent=profit; stStreak.textContent=maxStreak;

    if(allDealer){ setComment(dealerCommentEl, rnd(lines.dealerWin)); setComment(playerCommentEl,'–ú–∏–Ω—É—Å –±–∞–Ω–∞–Ω—ã. –ï—â—ë –ø–æ –æ–¥–Ω–æ–π?'); }
    else if(allPush){ setComment(dealerCommentEl, rnd(lines.push)); setComment(playerCommentEl,'–ü—É—à. –ë–∞–Ω–∞–Ω—ã –æ—Å—Ç–∞–ª–∏—Å—å –ø—Ä–∏ —Ç–µ–±–µ.'); }
    else { setComment(dealerCommentEl, anyBJ? rnd(lines.playerBlackjack): rnd(lines.playerWin)); setComment(playerCommentEl,'–ö—Ä–∞—Å–∏–≤–æ. –ü—Ä–æ–¥–æ–ª–∂–∏–º.'); }
    dealerScoreEl.textContent=dealerTotal; inRound=false;
  }

  function format(cards){ return cards.map(c=>c.rank+c.suit).join(' '); }
  function desc(o){ return o==='playerBJ'?'–ë–ª—ç–∫–¥–∂–µ–∫ (3:2)': o==='player'?'–ü–æ–±–µ–¥–∞': o==='push'?'–ü—É—à':'–ü–æ—Ä–∞–∂–µ–Ω–∏–µ'; }

  // --- Controls
  dealBtn.addEventListener('click', ()=>{ if(inRound) return; if(bank<OPT.minBet) return alert('–ë–∞–Ω–∞–Ω–æ–≤ –Ω–µ—Ç ‚Äî –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—É.'); startRound(); });
  hitBtn.addEventListener('click', ()=> !hitBtn.disabled && hit());
  standBtn.addEventListener('click', ()=> !standBtn.disabled && stand());
  doubleBtn.addEventListener('click', ()=> !doubleBtn.disabled && doDouble());
  splitBtn.addEventListener('click', ()=> !splitBtn.disabled && doSplit());
  surrenderBtn.addEventListener('click', ()=> !surrenderBtn.disabled && surrender());
  insuranceBtn.addEventListener('click', ()=> !insuranceBtn.disabled && takeInsurance());
  $$('.chip').forEach(btn=>btn.addEventListener('click', ()=>{
    let v=parseInt(betInput.value||25,10); const t=btn.dataset.chip;
    if(t==='max') v=Math.min(OPT.maxBet, bank); else v+=parseInt(t,10);
    v = clamp(v, OPT.minBet, Math.min(OPT.maxBet, bank)); betInput.value=v;
  }));

  // --- Init
  shoe = buildShoe(OPT.decks); updateShoeInfo(); ruleText.textContent= OPT.S17 ? 'S17' : 'H17';
  updateBank(); resetTableUI();

})();
</script>
</body>
</html>
