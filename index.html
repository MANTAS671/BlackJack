<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>–ë–ª—ç–∫–¥–∂–µ–∫ –ø—Ä–æ—Ç–∏–≤ –û–±–µ–∑—å—è–Ω—ã üêí ‚Äî –ü—Ä–µ–º–∏—É–º</title>
<style>
:root{
  --felt:#0b3e31; --felt2:#11614d; --gold:#f7d774; --accent:#ffbd59;
  --ink:#111; --card:#fffefa; --shadow:rgba(0,0,0,.25);
  --danger:#d84949; --ok:#26a269; --muted:#a7b0b2;
}
*{box-sizing:border-box}
html,body{margin:0;padding:0;background:radial-gradient(1200px 600px at 50% 10%, #145f4a, var(--felt)); color:#fff; font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,"Apple Color Emoji","Segoe UI Emoji";}
.app{min-height:100svh; display:flex; flex-direction:column; align-items:center; gap:12px; padding: clamp(10px, 2.5vw, 24px);}
.header{display:flex; align-items:center; justify-content:space-between; gap:10px; width:100%; max-width:1100px;}
.title{font-weight:900; letter-spacing:.2px; display:flex; align-items:center; gap:10px; font-size:1.1rem}
.monkey{font-size:1.6rem; filter: drop-shadow(0 2px 0 var(--shadow));}
.bank{margin-left:auto; background:linear-gradient(180deg,#ffeaa7,var(--gold)); color:#3a2a00; font-weight:900; padding:8px 12px; border-radius:12px; box-shadow:0 8px 20px var(--shadow), inset 0 1px 0 #fff6c6;}
.btn,button{appearance:none; border:none; background:linear-gradient(180deg,#ffd07b,var(--accent)); color:#3a2a00; font-weight:900; letter-spacing:.3px; padding:10px 12px; border-radius:12px; box-shadow:0 4px 0 #a86f18, 0 10px 20px var(--shadow); transform:translateY(0); transition:.1s; touch-action:manipulation; cursor:pointer}
.btn:active,button:active{transform:translateY(2px); box-shadow:0 2px 0 #a86f18, 0 6px 14px var(--shadow);}
button[disabled]{opacity:.45; filter:grayscale(.2); box-shadow:none; transform:none; cursor:not-allowed}
.secondary{background:linear-gradient(180deg,#f06d7d,#d34759); color:#fff; box-shadow:0 4px 0 #8b2732, 0 10px 20px var(--shadow);}
.ghost{background:linear-gradient(180deg,#b2bec3,#636e72); color:#fff; box-shadow:0 4px 0 #3e4548, 0 10px 20px var(--shadow);}
.success{background:linear-gradient(180deg,#70e1a1,#2ecc71); color:#14351f; box-shadow:0 4px 0 #1b9e57, 0 10px 20px var(--shadow);}
.danger{background:linear-gradient(180deg,#ff8c8c,#d84949); color:#fff; box-shadow:0 4px 0 #9c2f2f, 0 10px 20px var(--shadow);}

.table{position:relative; width:100%; max-width:1100px; background:linear-gradient(180deg, var(--felt2), var(--felt)); border-radius:18px; box-shadow:0 16px 40px var(--shadow), inset 0 0 0 2px rgba(255,255,255,.06); padding: clamp(10px, 2.2vw, 22px); overflow:hidden}
.glow{position:absolute; inset:-10% -10% auto -10%; height:60%; background:radial-gradient(80% 100% at 50% 0%, #ffffff22 0, #ffffff00 60%); pointer-events:none}
.monkey-bg{position:absolute; right:-40px; bottom:-30px; width:220px; height:220px; opacity:.12; filter:contrast(110%) saturate(110%); pointer-events:none}
.dealer-area,.player-area{display:grid; gap:8px;}
.dealer-area{padding-bottom:6px; border-bottom:1px dashed rgba(255,255,255,.25);}
.name-row{display:flex; align-items:center; gap:8px; font-weight:800;}
.avatar{width:36px;height:36px;border-radius:50%; background:
  radial-gradient(75% 75% at 30% 30%,#ffd180,#ffab40 60%,#ff9100),
  radial-gradient(100% 100% at 70% 30%,#ffd18000,#00000020 60%), #ffb74d;
  display:grid; place-items:center; box-shadow:0 3px 10px var(--shadow), inset 0 -2px 6px rgba(0,0,0,.25);}
.avatar span{filter: drop-shadow(0 1px 0 #00000044);}
.score{align-self:center; font-weight:900; padding:6px 10px; border-radius:10px; background:rgba(0,0,0,.25); box-shadow: inset 0 1px 0 rgba(255,255,255,.08);}
.comment{margin-top:2px; font-style:italic; opacity:.95}
.hands{display:flex; flex-direction:column; gap:8px}
.hand{display:flex; align-items:flex-start; gap:10px; flex-wrap:wrap; min-height:110px; padding:6px 0}
.hand.is-active{outline:2px dashed #ffeaa7; outline-offset:6px; border-radius:12px; padding:6px;}

.card{width:72px; height:104px; border-radius:10px; background:var(--card); box-shadow:0 6px 14px var(--shadow); position:relative; transform:translateY(-20px) scale(.98); opacity:0; animation:deal .45s ease forwards;}
@keyframes deal{to{transform:translateY(0) scale(1); opacity:1;}}
.card svg{width:100%;height:100%;display:block;}
.hidden .face{visibility:hidden}
.hidden::after{
  content:"üÇ†"; position:absolute; inset:0; display:grid; place-items:center; font-size:40px;
  background:repeating-linear-gradient(45deg, #2f3d8a 0 10px, #233171 10px 20px);
  color:#e5ecff; border-radius:10px;
}

.controls{display:grid; grid-template-columns:1fr; gap:10px; margin-top:10px;}
@media (min-width:740px){ .controls{grid-template-columns:1fr 1fr;} }
.row{display:flex; gap:8px; flex-wrap:wrap; align-items:center;}
input[type=number]{width:120px; padding:10px 12px; border-radius:10px; border:1px solid rgba(255,255,255,.2); background:rgba(0,0,0,.25); color:#fff; font-weight:700;}
.chips{display:flex; gap:8px; align-items:center;}
.chip{min-width:44px;height:44px;border-radius:999px; display:grid; place-items:center; background:radial-gradient(70% 70% at 35% 30%,#ff8a9a,#e84a5f); color:#fff; font-weight:900; box-shadow:0 4px 0 #9f2b3a, 0 10px 20px var(--shadow);}
.meta{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
.badge{padding:6px 10px; border-radius:999px; background:rgba(0,0,0,.28); font-weight:800; font-size:.9rem}

.footer{opacity:.85; font-size:.9rem; text-align:center; margin-top:8px}
.banner{position:absolute; left:50%; transform:translate(-50%, -120%); top:0; background:#222a; backdrop-filter:blur(6px); border:1px solid #fff2; padding:10px 14px; border-radius:10px; font-weight:800; opacity:0; pointer-events:none}
.banner.show{animation:drop .9s ease forwards}
@keyframes drop{0%{transform:translate(-50%,-120%); opacity:0} 40%{transform:translate(-50%,10%); opacity:1} 100%{transform:translate(-50%,-20%); opacity:1}}

.side{display:grid; gap:8px}
.panel{background:rgba(0,0,0,.25); border:1px solid #fff2; border-radius:12px; padding:10px}
.panel h3{margin:.2rem 0 .6rem; font-size:1rem}
.stats{display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:6px}
.stat{background:rgba(255,255,255,.06); padding:8px 10px; border-radius:10px; text-align:center; font-weight:800}
.log{max-height:160px; overflow:auto; font-size:.9rem}
.settings-btn{margin-left:6px}

dialog{border:none; border-radius:14px; padding:16px; background:#1a1f1c; color:#fff; max-width:520px; width:clamp(280px, 80vw, 520px); box-shadow:0 20px 60px #0009}
dialog::backdrop{background:#000c}
.field{display:flex; align-items:center; justify-content:space-between; gap:10px; padding:8px 0}
.range{width:180px}
.toggle{appearance:none; width:46px; height:28px; background:#666; border-radius:999px; position:relative}
.toggle::after{content:""; position:absolute; width:22px; height:22px; left:3px; top:3px; border-radius:50%; background:#fff; transition:.15s}
.toggle:checked{background:#3ac77a}
.toggle:checked::after{left:21px}
.small{font-size:.85rem; opacity:.9}
</style>
</head>
<body>
<div class="app">
  <div class="header">
    <div class="title"><span class="monkey">üêí</span> –ë–ª—ç–∫–¥–∂–µ–∫ –ø—Ä–æ—Ç–∏–≤ –û–±–µ–∑—å—è–Ω—ã ‚Äî –ü—Ä–µ–º–∏—É–º</div>
    <div class="meta">
      <span class="bank">–ë–∞–Ω–∞–Ω—ã: <span id="bank">500</span> üçå</span>
      <button id="settingsBtn" class="btn settings-btn">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
    </div>
  </div>

  <div class="table" id="table">
    <div class="glow"></div>
    <svg class="monkey-bg" viewBox="0 0 200 200" aria-hidden="true">
      <g fill="#fff">
        <circle cx="120" cy="120" r="60" opacity=".09"/>
        <circle cx="85" cy="90" r="12" opacity=".25"/>
        <circle cx="155" cy="90" r="12" opacity=".25"/>
        <circle cx="120" cy="140" r="20" opacity=".2"/>
        <rect x="100" y="160" width="40" height="6" rx="3" opacity=".25"/>
      </g>
    </svg>

    <div id="banner" class="banner">üîÅ –ü–µ—Ä–µ—Ç–∞—Å–æ–≤–∫–∞ –∫–æ–ª–æ–¥‚Ä¶ –û–±–µ–∑—å—è–Ω–∞ –≤–∑–±–∞–ª—Ç—ã–≤–∞–µ—Ç –±–∞–Ω–∞–Ω—ã</div>

    <div class="dealer-area">
      <div class="name-row">
        <div class="avatar"><span>üêí</span></div>
        <div><strong>–î–∏–ª–µ—Ä: –û–±–µ–∑—å—è–Ω–∞</strong></div>
        <div class="score" id="dealerScore">‚Äî</div>
        <span class="badge" id="shoeInfo">–¢—É—Ñ–ª—è: 6 –∫–æ–ª–æ–¥ ‚Ä¢ 0% –∏–∑—Ä–∞—Å—Ö–æ–¥–æ–≤–∞–Ω–æ</span>
      </div>
      <div class="hand" id="dealerHand"></div>
      <div class="comment" id="dealerComment">¬´–°—Ç–∞–≤–∫–∏ –ø–æ–≤—ã—à–µ ‚Äî –±–∞–Ω–∞–Ω—ã –ø–æ–≤–∫—É—Å–Ω–µ–µ‚Ä¶¬ª</div>
    </div>

    <div class="player-area">
      <div class="name-row">
        <div class="avatar" style="background:#6c5ce7"><span>üßë‚Äçüíª</span></div>
        <div><strong>–ò–≥—Ä–æ–∫: –≠–¥–≤–∞—Ä–¥</strong></div>
        <div class="score" id="playerScore">‚Äî</div>
        <span class="badge" id="ruleBadge">–ü—Ä–∞–≤–∏–ª–æ –¥–∏–ª–µ—Ä–∞: <b id="ruleText">S17</b></span>
      </div>

      <div class="hands" id="handsContainer">
        <div class="hand is-active" id="playerHand0"></div>
      </div>
      <div class="comment" id="playerComment">–ü–æ—Å—Ç–∞–≤—å –∏ –Ω–∞–∂–º–∏ ¬´–†–∞–∑–¥–∞—Ç—å¬ª.</div>
    </div>

    <div class="controls">
      <div class="row">
        <label for="bet"><strong>–°—Ç–∞–≤–∫–∞ (üçå):</strong></label>
        <input type="number" id="bet" min="1" step="1" value="25" />
        <div class="chips">
          <button class="chip" data-chip="10">+10</button>
          <button class="chip" data-chip="25">+25</button>
          <button class="chip" data-chip="50">+50</button>
          <button class="chip" data-chip="-10">-10</button>
          <button class="chip" data-chip="max">MAX</button>
        </div>
      </div>
      <div class="row">
        <button id="dealBtn" class="btn">–†–∞–∑–¥–∞—Ç—å</button>
        <button id="hitBtn" class="secondary" disabled>–ï—â—ë</button>
        <button id="standBtn" class="ghost" disabled>–•–≤–∞—Ç–∏—Ç</button>
        <button id="doubleBtn" class="btn" disabled>–î–∞–±–ª</button>
        <button id="splitBtn" class="btn" disabled>–°–ø–ª–∏—Ç</button>
        <button id="surrenderBtn" class="danger" disabled>–°–¥–∞—á–∞</button>
        <button id="insuranceBtn" class="success" disabled>–°—Ç—Ä–∞—Ö–æ–≤–∫–∞</button>
      </div>
    </div>

    <div class="side" style="margin-top:10px; grid-template-columns:1fr; display:grid; gap:10px">
      <div class="panel">
        <h3>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
        <div class="stats">
          <div class="stat">–†–∞—É–Ω–¥–æ–≤: <span id="stRounds">0</span></div>
          <div class="stat">–ü–æ–±–µ–¥: <span id="stWins">0</span></div>
          <div class="stat">–ü—É—à–µ–π: <span id="stPush">0</span></div>
          <div class="stat">–ë–ª—ç–∫–¥–∂–µ–∫–æ–≤: <span id="stBJ">0</span></div>
          <div class="stat">–ü—Ä–æ—Ñ–∏—Ç (üçå): <span id="stProfit">0</span></div>
          <div class="stat">–ú–∞–∫—Å —Å–µ—Ä–∏—è –ø–æ–±–µ–¥: <span id="stStreak">0</span></div>
        </div>
      </div>
      <div class="panel">
        <h3>–ò—Å—Ç–æ—Ä–∏—è</h3>
        <div id="log" class="log"></div>
      </div>
      <div class="footer">–ï—Å–ª–∏ –¥–∏–ª–µ—Ä –ø–æ–±–µ–¥–∏—Ç: ¬´<em>–û–±–µ–∑—å—è–Ω–∞ –≤–∞—Å –≤—ã–∏–≥—Ä–∞–ª–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞. –í—ã –ø–æ—Ç–µ—Ä—è–ª–∏ –±–∞–Ω–∞–Ω—ã.</em>¬ª ‚Äî –Ω–∏—á–µ–≥–æ –ª–∏—á–Ω–æ–≥–æ üêí</div>
    </div>
  </div>
</div>

<!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
<dialog id="settingsDlg">
  <form method="dialog">
    <h2 style="margin:.2rem 0 1rem">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å—Ç–æ–ª–∞</h2>
    <div class="field">
      <div><strong>S17</strong> ‚Äî –¥–∏–ª–µ—Ä <em>—Å—Ç–æ–∏—Ç</em> –Ω–∞ soft-17<br><span class="small">–ï—Å–ª–∏ –≤—ã–∫–ª—é—á–µ–Ω–æ ‚Äî H17 (–±–µ—Ä—ë—Ç –Ω–∞ soft-17)</span></div>
      <input id="optS17" type="checkbox" class="toggle" checked />
    </div>
    <div class="field">
      <div><strong>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–ª–æ–¥</strong><br><span class="small">–û—Ç 1 –¥–æ 8</span></div>
      <input id="optDecks" type="number" min="1" max="8" value="6" />
    </div>
    <div class="field">
      <div><strong>–ü–µ–Ω–µ—Ç—Ä–∞—Ü–∏—è, % –¥–æ –ø–µ—Ä–µ—Ç–∞—Å–æ–≤–∫–∏</strong><br><span class="small">–ß–µ–º –≤—ã—à–µ ‚Äî —Ç–µ–º –≥–ª—É–±–∂–µ —Ç—É—Ñ–ª—è</span></div>
      <input id="optPen" type="range" min="40" max="90" value="75" class="range" />
      <span id="optPenVal">75%</span>
    </div>
    <div class="field">
      <div><strong>–ú–∏–Ω/–ú–∞–∫—Å —Å—Ç–∞–≤–∫–∞</strong></div>
      <div>
        <input id="optMin" type="number" value="5" style="width:90px"> ‚Äî
        <input id="optMax" type="number" value="500" style="width:90px">
      </div>
    </div>
    <div class="field" style="justify-content:flex-end; gap:6px">
      <button class="ghost" value="cancel">–û—Ç–º–µ–Ω–∞</button>
      <button class="btn" id="saveSettings" value="default">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </div>
  </form>
</dialog>

<script>
(() => {
  // ======= Shortcuts =======
  const $ = s => document.querySelector(s);
  const $$ = s => Array.from(document.querySelectorAll(s));
  const logEl = $('#log');
  const banner = $('#banner');

  // ======= Options / Settings =======
  let OPT = { decks:6, penetration:75, S17:true, minBet:5, maxBet:500 };
  const settingsBtn = $('#settingsBtn');
  const dlg = $('#settingsDlg');
  const optS17 = $('#optS17'), optDecks = $('#optDecks'), optPen = $('#optPen'), optPenVal = $('#optPenVal'), optMin=$('#optMin'), optMax=$('#optMax');
  settingsBtn.addEventListener('click', ()=>{ optS17.checked = OPT.S17; optDecks.value = OPT.decks; optPen.value = OPT.penetration; optPenVal.textContent = OPT.penetration+'%'; optMin.value=OPT.minBet; optMax.value=OPT.maxBet; dlg.showModal(); });
  optPen.addEventListener('input', ()=> optPenVal.textContent = optPen.value + '%');
  $('#saveSettings').addEventListener('click', (e)=>{
    e.preventDefault();
    OPT.S17 = optS17.checked;
    OPT.decks = clamp(parseInt(optDecks.value||6,10),1,8);
    OPT.penetration = clamp(parseInt(optPen.value||75,10),40,90);
    OPT.minBet = Math.max(1, parseInt(optMin.value||5,10));
    OPT.maxBet = Math.max(OPT.minBet, parseInt(optMax.value||500,10));
    $('#ruleText').textContent = OPT.S17 ? 'S17' : 'H17';
    dlg.close();
    // rebuild shoe on settings change
    shoe = buildShoe(OPT.decks); updateShoeInfo();
    toast('‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã');
  });

  // ======= State =======
  const dealerHandEl = $('#dealerHand');
  const dealerScoreEl = $('#dealerScore');
  const dealerCommentEl = $('#dealerComment');

  const handsContainer = $('#handsContainer');
  const playerScoreEl = $('#playerScore');
  const playerCommentEl = $('#playerComment');

  const bankEl = $('#bank');
  const shoeInfoEl = $('#shoeInfo');
  const ruleText = $('#ruleText');

  const betInput = $('#bet');
  const dealBtn = $('#dealBtn');
  const hitBtn = $('#hitBtn');
  const standBtn = $('#standBtn');
  const doubleBtn = $('#doubleBtn');
  const splitBtn = $('#splitBtn');
  const surrenderBtn = $('#surrenderBtn');
  const insuranceBtn = $('#insuranceBtn');

  const stRounds = $('#stRounds'), stWins=$('#stWins'), stPush=$('#stPush'), stBJ=$('#stBJ'), stProfit=$('#stProfit'), stStreak=$('#stStreak');

  const lines = {
    start: [
      "¬´–°—Ç–∞–≤–∫–∏ –ø–æ–≤—ã—à–µ ‚Äî –±–∞–Ω–∞–Ω—ã –ø–æ–≤–∫—É—Å–Ω–µ–µ‚Ä¶¬ª",
      "¬´–°–µ–≥–æ–¥–Ω—è —á—É–≤—Å—Ç–≤—É—é –±–∞–Ω–∞–Ω–æ–≤—ã–π —à—Ç–æ—Ä–º —É–¥–∞—á–∏‚Ä¶ –¥–ª—è —Å–µ–±—è.¬ª",
      "¬´–ù–µ –±–æ–π—Å—è, —Ä–∞–∑–¥–∞—é —á–µ—Å—Ç–Ω–æ‚Ä¶ —á–µ—Å—Ç–Ω–æ-–æ–±–µ–∑—å—è–Ω–Ω–æ.¬ª"
    ],
    playerBlackjack: [
      "¬´–ë–ª—ç–∫–¥–∂–µ–∫? –ö—Ç–æ-—Ç–æ —Ä–∞–∑–≥–æ–≤–∞—Ä–∏–≤–∞–µ—Ç —Å –¥—É—Ö–∞–º–∏ –¥–∂—É–Ω–≥–ª–µ–π!¬ª",
      "¬´–£–≤–∞–∂–µ–Ω–∏–µ. –ù–æ —ç—Ç–æ —Å–ª—É—á–∞–π–Ω–æ—Å—Ç—å‚Ä¶ –Ω–∞–≤–µ—Ä–Ω–æ–µ.¬ª"
    ],
    dealerWin: [
      "¬´–û–±–µ–∑—å—è–Ω–∞ –≤–∞—Å –≤—ã–∏–≥—Ä–∞–ª–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞. –í—ã –ø–æ—Ç–µ—Ä—è–ª–∏ –±–∞–Ω–∞–Ω—ã.¬ª",
      "¬´–°–ø–∞—Å–∏–±–æ –∑–∞ —É–≥–æ—â–µ–Ω–∏–µ. –ë–∞–Ω–∞–Ω—ã —Å–≤–µ–∂–∏–µ!¬ª"
    ],
    playerWin: [
      "¬´–õ–∞–¥–Ω–æ, –∑–∞–±–∏—Ä–∞–π. –ù–æ —è –∑–∞–ø–æ–º–Ω—é‚Ä¶¬ª",
      "¬´–ë–∞–Ω–∞–Ω—ã —É—Ö–æ–¥—è—Ç‚Ä¶ –∫–∞–∫ –∏ –º–æ—ë —Ç–µ—Ä–ø–µ–Ω–∏–µ.¬ª"
    ],
    push: [
      "¬´–ü—É—à. –ë–∞–Ω–∞–Ω—ã –ø–æ–∫–∞ –ø—Ä–∏ —Ç–µ–±–µ.¬ª",
      "¬´–ù–∏—á—å—è ‚Äî —Å–∫—É—á–Ω–æ, –Ω–æ —á–µ—Å—Ç–Ω–æ.¬ª"
    ],
    hit: [
      "¬´–ï—â—ë? –°–º–µ–ª–æ. –ò–ª–∏ –±–µ–∑—Ä–∞—Å—Å—É–¥–Ω–æ.¬ª",
      "¬´–¢—è–Ω–∏! –î–∂—É–Ω–≥–ª–∏ –ª—é–±—è—Ç —Ä–∏—Å–∫.¬ª"
    ],
    stand: [
      "¬´–°—Ç–æ–∏—à—å? –ü–æ—Å–º–æ—Ç—Ä–∏–º, —á—Ç–æ —Å–∫–∞–∂–µ—Ç —Å—É–¥—å–±–∞.¬ª"
    ],
    double: [
      "¬´–î–∞–±–ª! –û–±–æ–∂–∞—é –∑–∞–ø–∞—Ö —Ä–∏—Å–∫–∞.¬ª"
    ],
    split: [
      "¬´–°–ø–ª–∏—Ç ‚Äî –¥–≤–∞ –±–∞–Ω–∞–Ω–æ–≤—ã—Ö —à–∞–Ω—Å–∞!¬ª"
    ],
    bust: [
      "¬´–ü–µ—Ä–µ–±–æ—Ä. –ù–µ –≥—Ä—É—Å—Ç–∏–º ‚Äî –±–∞–Ω–∞–Ω—ã –µ—â—ë –≤—ã—Ä–∞—Å—Ç—É—Ç.¬ª"
    ],
    insure: [
      "¬´–°—Ç—Ä–∞—Ö–æ–≤–æ—á–∫–∞? –í—ã–≥–ª—è–¥–∏—Ç –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ —É–º–Ω–æ‚Ä¶¬ª"
    ],
    surrender: [
      "¬´–°–¥–∞—á–∞ –ø—Ä–∏–Ω—è—Ç–∞. –ü–æ–ª–±–∞–Ω–∞–Ω–∞ –Ω–∞–∑–∞–¥.¬ª"
    ]
  };

  let shoe = [];
  let cutPoint = 0;
  let used = 0;

  let bank = 500;
  let inRound = false;
  let insuranceOffered = false;
  let insuranceTaken = 0;
  let surrenderedHands = new Set();

  let dealer = {hand: [], hideHole:true};
  let playerHands = []; // {cards:[], bet, done, doubled, isBust, isBJ, splitCount}
  let activeHandIndex = 0;
  const MAX_HANDS = 4;

  // Stats
  let rounds=0, wins=0, pushes=0, bjs=0, profit=0, streak=0, maxStreak=0;

  // ======= Deck / Shoe =======
  const ranks = ["A","2","3","4","5","6","7","8","9","10","J","Q","K"];
  const suits = [
    {s:"‚ô†", color:"#111"}, {s:"‚ô•", color:"#c62828"},
    {s:"‚ô¶", color:"#c62828"}, {s:"‚ô£", color:"#111"}
  ];
  function buildShoe(decks=6){
    const arr=[];
    for(let d=0; d<decks; d++){
      for(const r of ranks) for(const su of suits) arr.push({rank:r, suit:su.s, color:su.color});
    }
    shuffle(arr);
    used=0;
    cutPoint = Math.floor(arr.length * (OPT.penetration/100));
    return arr;
  }
  function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]];} return a; }
  function drawOne(){
    if(used >= cutPoint){ reshuffle(); }
    used++; updateShoeInfo();
    return shoe.pop();
  }
  function reshuffle(){
    banner.classList.add('show');
    setTimeout(()=>banner.classList.remove('show'), 1600);
    shoe = buildShoe(OPT.decks);
  }
  function updateShoeInfo(){
    const total = OPT.decks*52; const pct = Math.min(100, Math.floor(used/total*100));
    shoeInfoEl.textContent = `–¢—É—Ñ–ª—è: ${OPT.decks} –∫–æ–ª–æ–¥ ‚Ä¢ ${pct}% –∏–∑—Ä–∞—Å—Ö–æ–¥–æ–≤–∞–Ω–æ`;
  }

  // ======= Cards (SVG inline) =======
  function cardSVG(rank, suit, color="#111"){
    const top = rank + " " + suit, bot = suit + " " + rank;
    return `
    <svg viewBox="0 0 72 104" class="face" aria-label="${rank}${suit}">
      <defs><filter id="sd"><feDropShadow dx="0" dy="1" stdDeviation="1" flood-opacity=".25"/></filter></defs>
      <rect x="1.5" y="1.5" width="69" height="101" rx="9" fill="#fffefa" stroke="#e6e0cf"/>
      <text x="6" y="14" font-family="ui-sans" font-weight="900" font-size="12" fill="${color}">${top}</text>
      <g transform="rotate(180,36,52)"><text x="6" y="14" font-family="ui-sans" font-weight="900" font-size="12" fill="${color}">${bot}</text></g>
      <g filter="url(#sd)">${pips(rank, suit, color)}</g>
    </svg>`;
  }
  function pips(rank, suit, color){
    const cx=36, cy=52;
    if(rank==="A") return `<text x="${cx}" y="${cy+10}" text-anchor="middle" font-size="52" font-weight="900" fill="${color}">${suit}</text>`;
    if(/^[2-9]|10$/.test(rank)){
      const n = (rank==="10")?10:parseInt(rank,10);
      const coords = [[36,32],[36,72],[20,42],[52,42],[20,62],[52,62],[20,32],[52,32],[20,72],[52,72]];
      return coords.slice(0,n).map(([x,y])=>`<text x="${x}" y="${y}" text-anchor="middle" font-size="18" font-weight="800" fill="${color}">${suit}</text>`).join("");
    }
    return `<text x="${cx}" y="${cy+10}" text-anchor="middle" font-size="46" font-weight="800" fill="${color}">${suit}</text>`;
  }
  function createCardEl(card, hidden=false, delayIdx=0){
    const el = document.createElement('div');
    el.className = 'card' + (hidden ? ' hidden' : '');
    el.style.animationDelay = (0.08 * delayIdx) + 's';
    el.innerHTML = card ? cardSVG(card.rank, card.suit, card.color) : '';
    return el;
  }

  // ======= Values / Rules =======
  function handValue(cards){
    let total=0, aces=0;
    for(const c of cards){
      if(c.rank==="A"){ total+=11; aces++; }
      else if(["K","Q","J"].includes(c.rank)){ total+=10; }
      else total += (c.rank==="10"?10:parseInt(c.rank,10));
    }
    while(total>21 && aces>0){ total-=10; aces--; }
    return total;
  }
  const isBJ = (cards)=> cards.length===2 && handValue(cards)===21;
  const isPair = (cards)=> cards.length===2 && rankValue(cards[0])===rankValue(cards[1]);
  function rankValue(c){ if(c.rank==="A") return 11; if(["K","Q","J","10"].includes(c.rank)) return 10; return parseInt(c.rank,10) }

  // ======= UI Helpers =======
  function getActiveEl(){ return $('#playerHand'+activeHandIndex); }
  function setActiveHand(idx){
    $$('.hand').forEach(h=>h.classList.remove('is-active'));
    activeHandIndex = idx; $('#playerHand'+idx).classList.add('is-active');
    refreshScores(); setActionsForActive();
  }
  function toast(txt){ banner.textContent = txt; banner.classList.add('show'); setTimeout(()=>banner.classList.remove('show'), 1600); }
  function setComment(el, t){ el.textContent = t; }
  function updateBank(){ bankEl.textContent = bank; }
  function clamp(v,min,max){ return Math.max(min, Math.min(max, v)); }

  // ======= Round Flow =======
  function resetTableUI(){
    dealerHandEl.innerHTML=''; dealerScoreEl.textContent='‚Äî';
    handsContainer.innerHTML=''; const h=document.createElement('div'); h.id='playerHand0'; h.className='hand is-active'; handsContainer.appendChild(h);
    playerScoreEl.textContent='‚Äî';
    setComment(dealerCommentEl, rnd(lines.start)); setComment(playerCommentEl, '–ü–æ—Å—Ç–∞–≤—å –∏ –Ω–∞–∂–º–∏ ¬´–†–∞–∑–¥–∞—Ç—å¬ª.');
    surrenderedHands.clear(); insuranceTaken=0; insuranceOffered=false;
  }
  function refreshScores(){
    const dVal = dealer.hideHole ? handValue(dealer.hand.slice(1)) : handValue(dealer.hand);
    dealerScoreEl.textContent = dealer.hideHole ? `? + ${handValue([dealer.hand[1]])}` : dVal;
    const active = playerHands[activeHandIndex] || playerHands[0];
    playerScoreEl.textContent = handValue(active.cards);
  }
  function setActionsForActive(){
    const h = playerHands[activeHandIndex];
    const initial = h.cards.length===2;
    hitBtn.disabled = false;
    standBtn.disabled = false;
    doubleBtn.disabled = !initial || bank < h.bet;
    splitBtn.disabled  = !(initial && isPair(h.cards) && playerHands.length<MAX_HANDS && bank >= h.bet);
    surrenderBtn.disabled = !initial;
    // insurance only at start if dealer upcard Ace and not yet decided
    const dealerUpAce = dealer.hand[1]?.rank === 'A' && dealer.hideHole;
    insuranceBtn.disabled = !(initial && dealerUpAce && !insuranceOffered && bank >= Math.floor(h.bet/2));
  }

  function startRound(){
    // bet clamp
    let b = parseInt(betInput.value||25,10);
    b = clamp(b, OPT.minBet, Math.min(OPT.maxBet, bank));
    betInput.value = b;
    if(b < OPT.minBet){ return alert(`–ú–∏–Ω —Å—Ç–∞–≤–∫–∞ ${OPT.minBet}üçå`); }
    if(b>bank){ return alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–∞–Ω–∞–Ω–æ–≤."); }

    inRound = true; surrenderedHands.clear(); insuranceTaken=0; insuranceOffered=false;

    bank -= b; updateBank();

    dealer = {hand:[], hideHole:true};
    playerHands = [{cards:[], bet:b, done:false, doubled:false, isBust:false, isBJ:false, splitCount:0}];
    activeHandIndex = 0;

    resetTableUI();

    // deal P, D(hole), P, D(upcard)
    const ph = getActiveEl();
    const p1 = drawOne(); playerHands[0].cards.push(p1); ph.appendChild(createCardEl(p1,false,0));
    const d1 = drawOne(); dealer.hand.push(d1); dealerHandEl.appendChild(createCardEl(d1,true,1));
    const p2 = drawOne(); playerHands[0].cards.push(p2); ph.appendChild(createCardEl(p2,false,2));
    const d2 = drawOne(); dealer.hand.push(d2); dealerHandEl.appendChild(createCardEl(d2,false,3));

    refreshScores();

    // Insurance offer if Ace up
    maybeOfferInsurance();

    // Blackjack checks
    if(isBJ(playerHands[0].cards)){
      playerHands[0].isBJ = true;
      // –µ—Å–ª–∏ —É –¥–∏–ª–µ—Ä–∞ —Ç—É–∑ –∏ –±—É–¥–µ—Ç –±–ª—ç–∫–¥–∂–µ–∫ ‚Äî –±—É–¥–µ—Ç –ø—É—à; –∏–Ω–∞—á–µ –≤—ã–ø–ª–∞—Ç–∞ 3:2
      finishPlayerPhase(true);
      return;
    }

    dealBtn.disabled = true;
    setActionsForActive();
    setComment(playerCommentEl, '–¢–≤–æ–π —Ö–æ–¥: –ï—â—ë / –•–≤–∞—Ç–∏—Ç / –î–∞–±–ª / –°–ø–ª–∏—Ç / –°–¥–∞—á–∞.');
  }

  function maybeOfferInsurance(){
    const up = dealer.hand[1];
    if(up && up.rank==='A'){
      insuranceOffered = true;
      insuranceBtn.disabled = false;
      setComment(dealerCommentEl, '¬´–¢—É–∑ –Ω–∞–≤–µ—Ä—Ö—É‚Ä¶ –±–µ—Ä—ë—à—å —Å—Ç—Ä–∞—Ö–æ–≤–∫—É?¬ª');
    }
  }

  function takeInsurance(){
    const hand = playerHands[activeHandIndex];
    const cost = Math.floor(hand.bet/2);
    if(bank < cost) return alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–∞–Ω–∞–Ω–æ–≤ –Ω–∞ —Å—Ç—Ä–∞—Ö–æ–≤–∫—É.');
    bank -= cost; updateBank();
    insuranceTaken = cost;
    insuranceBtn.disabled = true;
    setComment(dealerCommentEl, rnd(lines.insure));
  }

  function surrender(){
    const h = playerHands[activeHandIndex];
    if(h.cards.length!==2) return;
    surrenderedHands.add(activeHandIndex);
    h.done = true;
    setComment(dealerCommentEl, rnd(lines.surrender));
    // –≤–µ—Ä–Ω—É—Ç—å –ø–æ–ª–æ–≤–∏–Ω—É
    const refund = Math.floor(h.bet/2);
    bank += refund; updateBank();
    log(`–°–¥–∞—á–∞ —Ä—É–∫–∏ #${activeHandIndex+1}: –≤–æ–∑–≤—Ä–∞—Ç ${refund}üçå`);
    nextHandOrDealer();
  }

  function hit(){
    const h = playerHands[activeHandIndex];
    const el = getActiveEl();
    const c = drawOne(); h.cards.push(c); el.appendChild(createCardEl(c,false,h.cards.length+1));
    setComment(dealerCommentEl, rnd(lines.hit));
    refreshScores();
    // after hit
    doubleBtn.disabled = true; splitBtn.disabled = true; surrenderBtn.disabled = true; insuranceBtn.disabled = true;
    const v = handValue(h.cards);
    if(v>21){ h.isBust = true; setComment(dealerCommentEl, rnd(lines.bust)); nextHandOrDealer(); }
  }

  function stand(){
    setComment(dealerCommentEl, rnd(lines.stand));
    nextHandOrDealer();
  }

  function doDouble(){
    const h = playerHands[activeHandIndex];
    if(h.cards.length!==2 || bank < h.bet) return;
    bank -= h.bet; h.bet *= 2; h.doubled = true; updateBank();
    setComment(dealerCommentEl, rnd(lines.double));
    hit();
    if(!h.isBust) nextHandOrDealer();
  }

  function doSplit(){
    const base = playerHands[activeHandIndex];
    if(!(base.cards.length===2 && isPair(base.cards))) return;
    if(playerHands.length>=MAX_HANDS) return alert('–ú–∞–∫—Å–∏–º—É–º 4 —Ä—É–∫–∏.');
    if(bank < base.bet) return alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–∞–Ω–∞–Ω–æ–≤ –Ω–∞ —Å–ø–ª–∏—Ç.');

    bank -= base.bet; updateBank();
    setComment(dealerCommentEl, rnd(lines.split));

    const c1 = base.cards[0], c2 = base.cards[1];
    base.cards = [c1]; base.splitCount++;
    const newHand = {cards:[c2], bet: base.bet, done:false, doubled:false, isBust:false, isBJ:false, splitCount:base.splitCount};
    playerHands.splice(activeHandIndex+1, 0, newHand);

    reRenderHands();

    // —Ä–∞–∑–¥–∞—ë–º –ø–æ –æ–¥–Ω–æ–π –∫–∞—Ä—Ç–µ –∫ –∫–∞–∂–¥–æ–π —Ä—É–∫–µ
    const giveTo = (h, idx) => {
      const card = drawOne(); h.cards.push(card);
      $('#playerHand'+idx).appendChild(createCardEl(card,false,1));
    };
    giveTo(base, activeHandIndex);
    giveTo(newHand, activeHandIndex+1);

    // –µ—Å–ª–∏ —Å–ø–ª–∏—Ç —Ç—É–∑–æ–≤ ‚Äî —Å—Ç–æ–∏–º —Å—Ä–∞–∑—É
    if(c1.rank==="A" && c2.rank==="A"){ nextHandOrDealer(true); }
    else { refreshScores(); setActionsForActive(); }
  }

  function reRenderHands(){
    handsContainer.innerHTML='';
    playerHands.forEach((h, idx)=>{
      const div=document.createElement('div'); div.id='playerHand'+idx; div.className='hand'+(idx===activeHandIndex?' is-active':'');
      // –æ—Ç—Ä–∏—Å–æ–≤–∞—Ç—å —É–∂–µ –∏–º–µ—é—â–∏–µ—Å—è –∫–∞—Ä—Ç—ã
      h.cards.forEach((c,i)=> div.appendChild(createCardEl(c,false,i)));
      handsContainer.appendChild(div);
    });
  }

  function nextHandOrDealer(forceFinish=false){
    playerHands[activeHandIndex].done = true;
    // –∫ —Å–ª–µ–¥—É—é—â–µ–π –Ω–µ–∑–∞–≤–µ—Ä—à—ë–Ω–Ω–æ–π —Ä—É–∫–µ
    const nextIdx = playerHands.findIndex((h, idx)=> idx>activeHandIndex && !h.done);
    if(nextIdx!==-1 && !forceFinish){
      setActiveHand(nextIdx);
      return;
    }
    // –∏–≥—Ä–æ–∫ –∑–∞–∫–æ–Ω—á–∏–ª ‚Äî –¥–∏–ª–µ—Ä –∏–≥—Ä–∞–µ—Ç
    finishPlayerPhase(false);
  }

  function finishPlayerPhase(fromBJCheck){
    hitBtn.disabled = standBtn.disabled = doubleBtn.disabled = splitBtn.disabled = surrenderBtn.disabled = insuranceBtn.disabled = true;
    // –µ—Å–ª–∏ —É –∏–≥—Ä–æ–∫–∞ BJ –∏ —É –¥–∏–ª–µ—Ä–∞ —Ç—É–∑ ‚Äî –ø—Ä–æ–≤–µ—Ä–∏–º –¥–∏–ª–µ—Ä–∞
    if(fromBJCheck){ /* fallthrough */ }
    dealerPlay();
  }

  function dealerPlay(){
    dealer.hideHole=false;
    if(dealerHandEl.firstElementChild) dealerHandEl.firstElementChild.classList.remove('hidden');
    refreshScores();

    const hasAnyActive = playerHands.some((h,idx)=> !h.isBust && !surrenderedHands.has(idx));
    if(!hasAnyActive){ return resolveRound(); }

    const play = () => {
      let v = handValue(dealer.hand);
      const soft = isSoft(dealer.hand);
      const mustHit = v<17 || (!OPT.S17 && v===17 && soft);
      if(mustHit){
        const c = drawOne(); dealer.hand.push(c); dealerHandEl.appendChild(createCardEl(c,false,dealer.hand.length+1));
        refreshScores(); setTimeout(play, 550);
      } else { resolveRound(); }
    };
    setTimeout(play, 550);
  }

  function isSoft(cards){
    // true if any Ace counted as 11 without bust
    let total=0, aces=0;
    for(const c of cards){
      if(c.rank==="A"){ total+=11; aces++; } else if(["K","Q","J"].includes(c.rank)){ total+=10; } else total+=(c.rank==="10"?10:parseInt(c.rank,10));
    }
    while(total>21 && aces>0){ total-=10; aces--; }
    return aces>0; // at least one Ace still valued 11
  }

  function resolveRound(){
    dealBtn.disabled=false;
    const dealerTotal = handValue(dealer.hand);
    const dealerBJ = isBJ(dealer.hand);

    // –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å —Å—Ç—Ä–∞—Ö–æ–≤–∫—É
    if(insuranceTaken){
      if(dealerBJ){
        // —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞ –ø–ª–∞—Ç–∏—Ç 2:1 -> +cost*3 (–≤–æ–∑–≤—Ä–∞—Ç + –≤—ã–∏–≥—Ä—ã—à), –Ω–æ –º—ã —É–∂–µ —Å–ø–∏—Å–∞–ª–∏ cost
        bank += insuranceTaken * 3;
        log(`–°—Ç—Ä–∞—Ö–æ–≤–∫–∞ –≤—ã–ø–ª–∞—Ç–∏–ª–∞ ${insuranceTaken*2}üçå`);
      } else {
        log(`–°—Ç—Ä–∞—Ö–æ–≤–∫–∞ –ø—Ä–æ–∏–≥—Ä–∞–ª–∞ ${insuranceTaken}üçå`);
      }
      insuranceTaken = 0; updateBank();
    }

    let roundProfit = 0;
    let allDealer = true, allPush=true, anyBJ=false, anyPlayerWin=false;

    playerHands.forEach((h, idx)=>{
      if(surrenderedHands.has(idx)){
        allDealer = false; allPush = false;
        return; // —É–∂–µ —É—á—Ç–µ–Ω–æ –ø—Ä–∏ —Å–¥–∞—á–µ
      }
      const total = handValue(h.cards);
      let delta=0, outcome='';

      if(h.isBJ && !dealerBJ){
        delta = Math.floor(h.bet * 2.5);
        outcome='playerBJ'; anyBJ=true; anyPlayerWin=true; allDealer=false; allPush=false; bjs++;
      } else if(h.isBust){
        delta = 0; outcome='dealer';
      } else if(dealerTotal>21){
        delta = h.bet*2; outcome='player'; anyPlayerWin=true; allDealer=false; allPush=false;
      } else if(dealerBJ && !h.isBJ){
        delta = 0; outcome='dealer';
      } else if(total > dealerTotal){
        delta = h.bet*2; outcome='player'; anyPlayerWin=true; allDealer=false; allPush=false;
      } else if(total < dealerTotal){
        delta = 0; outcome='dealer';
      } else {
        delta = h.bet; outcome='push'; allDealer=false; // push not dealer win
      }

      roundProfit += (delta - h.bet); // —á–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å –ø–æ —Ä—É–∫–µ
      const tag = outcome==='player' || outcome==='playerBJ' ? '‚úÖ' : (outcome==='push' ? '‚è∏Ô∏è' : '‚ùå');
      log(`${tag} –†—É–∫–∞ #${idx+1}: ${formatHand(h.cards)} vs ${dealerTotal} ‚Äî ${outcomeDesc(outcome)} | Œî ${delta - h.bet}üçå`);
      if(outcome==='push') allPush &= true; else allPush=false;
    });

    // –æ–±–Ω–æ–≤–∏—Ç—å –±–∞–Ω–∫/—Å—Ç–∞—Ç—ã
    bank += 0; updateBank(); // —É–∂–µ –æ–±–Ω–æ–≤–ª—è–ª–∏ –ø–æ —Ö–æ–¥—É; –∑–¥–µ—Å—å roundProfit –æ—Ç—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –ø—Ä–æ—Ñ–∏—Ç–µ
    profit += roundProfit;
    rounds++;
    if(anyPlayerWin){ wins++; streak++; maxStreak = Math.max(maxStreak, streak); } else if(allPush){ /* streak stays */ } else { streak=0; }
    stRounds.textContent=rounds; stWins.textContent=wins; stPush.textContent=pushes; stBJ.textContent=bjs; stProfit.textContent=profit; stStreak.textContent=maxStreak;

    // –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
    if(allDealer){
      setComment(dealerCommentEl, rnd(lines.dealerWin));
      setComment(playerCommentEl, '–†–∞—É–Ω–¥ –ø—Ä–æ–∏–≥—Ä–∞–Ω. –ñ–º–∏ ¬´–†–∞–∑–¥–∞—Ç—å¬ª, –æ—Ç—ã–≥—Ä–∞–µ–º—Å—è! üçå');
    } else if(allPush){
      pushes++; stPush.textContent=pushes;
      setComment(dealerCommentEl, rnd(lines.push));
      setComment(playerCommentEl, '–ü—É—à. –°—Ç–∞–≤–∫–∞ –≤–µ—Ä–Ω—É–ª–∞—Å—å.');
    } else {
      setComment(dealerCommentEl, anyBJ ? rnd(lines.playerBlackjack) : rnd(lines.playerWin));
      setComment(playerCommentEl, '–ö—Ä–∞—Å–∏–≤–æ —Å—ã–≥—Ä–∞–Ω–æ. –ï—â—ë –ø–æ –±–∞–Ω–∞–Ω—á–∏–∫—É?');
    }
    dealerScoreEl.textContent = dealerTotal;
    inRound=false;
  }

  function outcomeDesc(o){
    return o==='playerBJ'?'–ë–ª—ç–∫–¥–∂–µ–∫ (3:2)':
           o==='player'?'–ü–æ–±–µ–¥–∞':
           o==='push'?'–ü—É—à':'–ü–æ—Ä–∞–∂–µ–Ω–∏–µ';
  }
  function formatHand(cards){
    return cards.map(c=>c.rank+c.suit).join(' ');
  }

  // ======= Events =======
  dealBtn.addEventListener('click', ()=>{
    if(inRound) return;
    if(bank < OPT.minBet){ return alert('–ë–∞–Ω–∞–Ω–æ–≤ –Ω–µ—Ç. –û–±–Ω–æ–≤–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –Ω–æ–≤–æ–≥–æ –±–∞–Ω–∫—Ä–æ–ª–∞.'); }
    startRound();
  });
  hitBtn.addEventListener('click', ()=> !hitBtn.disabled && hit());
  standBtn.addEventListener('click', ()=> !standBtn.disabled && stand());
  doubleBtn.addEventListener('click', ()=> !doubleBtn.disabled && doDouble());
  splitBtn.addEventListener('click', ()=> !splitBtn.disabled && doSplit());
  surrenderBtn.addEventListener('click', ()=> !surrenderBtn.disabled && surrender());
  insuranceBtn.addEventListener('click', ()=> !insuranceBtn.disabled && takeInsurance());

  // quick chips
  $$('.chip').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      let v = parseInt(betInput.value||25,10);
      const t = btn.dataset.chip;
      if(t==='max'){ v = Math.min(OPT.maxBet, bank); }
      else { v += parseInt(t,10); }
      v = clamp(v, OPT.minBet, Math.min(OPT.maxBet, bank));
      betInput.value = v;
    });
  });

  function rnd(a){ return a[Math.floor(Math.random()*a.length)]; }
  function log(msg){
    const row = document.createElement('div');
    row.textContent = msg;
    logEl.prepend(row);
  }

  // Init
  shoe = buildShoe(OPT.decks); updateShoeInfo(); ruleText.textContent = OPT.S17 ? 'S17' : 'H17';
  updateBank(); resetTableUI();
})();
</script>
</body>
</html>
